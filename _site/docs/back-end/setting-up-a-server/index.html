<!DOCTYPE html>

<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <title>Setting Up A Server - Harker Dev Documentation</title>
  <link rel="stylesheet" href="http://localhost:4000/docs/assets/css/just-the-docs.css">
  
  <script type="text/javascript" src="http://localhost:4000/docs/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="http://localhost:4000/docs/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>


  <div class="page-wrap">
    <div class="side-bar">
      <a href="http://localhost:4000/docs" class="site-title fs-6 lh-tight">Harker Dev Documentation</a>
      <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button" data-text-toggle="Hide">Menu</button></span>
      <div class="navigation main-nav js-main-nav">
        <nav>
  <ul class="navigation-list">
    
    
      
        
      
    
      
        
      
    
      
        
          <li class="navigation-list-item">
            
            <a href="http://localhost:4000/docs/" class="navigation-list-link">Home</a>
            
          </li>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <li class="navigation-list-item">
            
            <a href="http://localhost:4000/docs/contribution" class="navigation-list-link">Contribution</a>
            
              
              <ul class="navigation-list-child-list ">
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/contribution/github/" class="navigation-list-link">GitHub Contributions</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/contribution/creating-mainting-project/" class="navigation-list-link">Developing a Project</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              </ul>
            
          </li>
        
      
    
      
        
          <li class="navigation-list-item">
            
            <a href="http://localhost:4000/docs/frontend" class="navigation-list-link">Front End Development</a>
            
              
              <ul class="navigation-list-child-list ">
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/front-end/add-page/" class="navigation-list-link">Adding a Page to Node.js Apps</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/front-end/reference-partial-page/" class="navigation-list-link">Referencing a Partial Page</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/front-end/frontend-dev/" class="navigation-list-link">Front End Development Practices</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
              </ul>
            
          </li>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <li class="navigation-list-item active">
            
            <a href="http://localhost:4000/docs/backend" class="navigation-list-link">Back End Development</a>
            
              
              <ul class="navigation-list-child-list ">
                
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/back-end/mongodb-access-with-compass/" class="navigation-list-link">Access MongoDB with Compass</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/back-end/test-files-database/" class="navigation-list-link">Populate Database w/ Test Files</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item  active">
                      
                      <a href="http://localhost:4000/docs/docs/back-end/setting-up-a-server/" class="navigation-list-link active">Setting Up A Server</a>
                      
                    </li>
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/docs/docs/back-end/mongodb-backup/" class="navigation-list-link">MongoDB Backup</a>
                      
                    </li>
                  
                
                  
                
              </ul>
            
          </li>
        
      
    
  </ul>
</nav>

      </div>
      <footer role="contentinfo" class="site-footer">
        <p class="text-small text-grey-dk-000 mb-0">Feel free to reach out to us at <a href="mailto:dev@harker.org">dev@harker.org</a>.</p>
      </footer>
    </div>
    <div class="main-content-wrap">
      <div class="page-header">
        <div class="main-content">
          
          <div class="search js-search">
            <div class="search-input-wrap">
              <input type="text" class="js-search-input search-input" placeholder="Search Harker Dev Documentation" aria-label="Search Harker Dev Documentation" autocomplete="off">
              <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg>
            </div>
            <div class="js-search-results search-results-wrap"></div>
          </div>
          
          
            <ul class="list-style-none text-small mt-md-1 mb-md-1 pb-4 pb-md-0 js-aux-nav aux-nav">
              
                <li class="d-inline-block my-0"><a href="//github.com/harkerdev">View our Organization on Github</a></li>
              
            </ul>
          
        </div>
      </div>
      <div class="main-content">
        
          
            <nav class="breadcrumb-nav">
              <ol class="breadcrumb-nav-list">
                
                  <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/backend">Back End Development</a></li>
                
                <li class="breadcrumb-nav-list-item"><span>Setting Up A Server</span></li>
              </ol>
            </nav>
          
        
        <div class="page-content">
          <p>You’ll be writing code for two different environments: development and production. The production environment is the server. The stuff on it should be free of errors, and ideally you don’t want to be testing anything in production. The development environment is what you run on your machine. You should ideally test your changes in your development environment before deploying them to production.</p>

<h2 id="development">Development</h2>

<p>Because you’ll be the only one testing the application locally on your computer (or maybe somehow you could involve a few others), it is enough to only utilize one core of your machine and not worry about the application’s response to load. For that reason, getting things set up locally doesn’t involve too much.</p>

<h3 id="installation">Installation</h3>

<h4 id="1-git">1. Git</h4>

<p>In order to clone the repository you’ll need Git installed. There are a million guides (maybe not quite a million, but a good amount) on the internet on how to do this. <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">Here is one such guide.</a> If you’re on Windows, want to use the command line, want to clone over https, and want to use Two Factor Authentication for GitHub you’ll also want to use <a href="https://github.com/Microsoft/Git-Credential-Manager-for-Windows]">Microsoft’s Git Credential Manger for Windows</a>. Oh yeah and if you don’t want to use git’s command line client (which is very powerful), there are various GUIs built for it, one such being <a href="https://desktop.github.com/">GitHub Desktop</a>.</p>

<h4 id="2-nodejs">2. Node.js</h4>

<p>In order to run the code you’ll need Node.js (assuming we’re using that as the programming language). Different projects will have different minimum versions depending on how long ago they were coded. If you don’t know what version you’ll need, consult with whoever set up the server for the project and see what version is on the server.</p>

<p>There are different ways of handling multiple Node.js versions. One such way is to install <a href="https://github.com/tj/n"><code class="highlighter-rouge">n</code></a>, an application for managing these different versions. Unfortunately this is not supported on Windows. However, given that Node.js is mostly backwards-compatible, you may be able to get by with installing the latest version. Just be aware of new features not available in the version being used for the project.</p>

<h4 id="3-mongodb">3. MongoDB</h4>

<p>Most of our projects use MongoDB as a database. You can get that from <a href="https://www.mongodb.com/download-center#community">here</a>.</p>

<h3 id="running">Running</h3>

<ol>
  <li>
    <p>Open Terminal. If on macOS, and enter the command <code class="highlighter-rouge">mongod</code> in a new Terminal window. If on Linux, enter the command <code class="highlighter-rouge">sudo service mongod start</code>. If on Windows, first create a new folder called data with a folder inside called db on your local disk (usually the C drive). Then run mongod.exe to launch the database. You can do this by opening command prompt and entering the path to the executable (by default it is <code class="highlighter-rouge">"C:\Program Files\MongoDB\Server\3.4\bin\mongod.exe"</code>).</p>
  </li>
  <li>
    <p>In Terminal (If using macOS, open a new Terminal window), open the repository’s directory, and enter the command <code class="highlighter-rouge">node index.js</code>, and press the <code class="highlighter-rouge">control</code> and <code class="highlighter-rouge">C</code> keys at the same time to stop it. To have the program run detached from the terminal (so it continues running after you exit the Terminal window), enter the command <code class="highlighter-rouge">nohup node index.js</code>. If on Windows, open command prompt, navigate to the repository’s directory, and enter the command <code class="highlighter-rouge">node index.js</code>. Press the <code class="highlighter-rouge">control</code> and <code class="highlighter-rouge">C</code>at the same time to stop it.</p>
  </li>
  <li>
    <p>Open <code class="highlighter-rouge">http://localhost:&lt;port&gt;</code> in your browser, where <code class="highlighter-rouge">&lt;port&gt;</code> is the port specified in your config file.</p>
  </li>
</ol>

<h2 id="production">Production</h2>

<h3 id="installing">Installing</h3>

<p>In the production environment since performance matters we use more software to help handle the load of many students accessing an application at once. This will be discussed below.</p>

<ol>
  <li>
    <p>Node.js</p>

    <p>We use Ubuntu as the OS. Node.js has a guide for installing Node.js on Ubuntu <a href="https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions">here</a>.</p>
  </li>
  <li>
    <p>Nginx</p>

    <p>Nginx is a web server that can serve static content as well as act as a proxy. It is much more efficient than doing anything in Node.js, therefore we use it to serve the static content for the site, manage TLS, as well as proxy the Node.js code. For most software installation on the Development server, DigitalOcean always has very good guides. They happen to publish ones on installing Nginx, so to find the one relevant to your Ubuntu version search for something like “nginx install ubuntu” and find the relevant link. For example <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04">here</a> is the one for 16.04. Now for this guide because Harker has its own firewall and we don’t host with DigitalOcean you can ignore the part with <code class="highlighter-rouge">ufw</code>. Pretty much all you need to do as of writing is <code class="highlighter-rouge">sudo apt-get update</code> and <code class="highlighter-rouge">sudo apt-get install nginx</code>.</p>
  </li>
  <li>
    <p>pm2</p>

    <p>Another thing that makes the application more performant in production is utilizing multiple cores. Node.js has ways to do this an the application, but pm2 makes this much easier and in facts prevents you from having to write any code for utilizing multiple cores. It also handle auto-restarting the application if there are any errors and saving log files. To install it follow the instructions <a href="http://pm2.keymetrics.io/docs/usage/quick-start/#installation">here</a>.</p>
  </li>
  <li>
    <p>Certbot</p>

    <p>To prevent having to wait for Harker to give us SSL certificates, we use the Let’s Encrypt service. In order to use it, we’ll need an application for registering with said service. Again, DigitalOcean has a nice guide for this. As said before their guides are Ubuntu-version specific, but <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-16-04">here’s</a> the one for 16.04. You can skip the parts about setting up nginx and updating <code class="highlighter-rouge">ufw</code>. When you get to running the <code class="highlighter-rouge">certbot</code> commands, you’ll need to have set up nginx and disabled https redirection (as we won’t have a certificate yet). Make sure to complete the part titled “Updating Diffie-Hellman Parameters”, but don’t edit the config as that will already be handled. You’ll also want to set up auto-renewal (which is covered in the guide).</p>
  </li>
  <li>
    <p>MongoDB</p>

    <p>You can refer to <a href="https://docs.mongodb.com/v3.0/tutorial/install-mongodb-on-ubuntu/">MongoDB’s guide</a> for this.</p>
  </li>
</ol>

<h3 id="setup">Setup</h3>

<p>Nginx has two different directories for configuration: <code class="highlighter-rouge">/etc/nginx/sites-available/</code> and <code class="highlighter-rouge">/etc/nginx/sites-enabled/</code>. The configuration files are stored in <code class="highlighter-rouge">sites-available</code>, and they are symlinked (use <code class="highlighter-rouge">ln -s</code>) to <code class="highlighter-rouge">sites-enabled</code>. Grab a previous config file from <code class="highlighter-rouge">sites-available</code> (it’s name will match the DNS name of the site), and put that in the same folder on the new server but with the appropriate name. You’ll also want to copy over the files in <code class="highlighter-rouge">/etc/nginx/snippets</code>.</p>

<p>Then delete the default site symlink in <code class="highlighter-rouge">/etc/nginx/sites-available/</code> and symlink the new file in <code class="highlighter-rouge">site-available</code> to <code class="highlighter-rouge">sites-enabled</code>. You’ll then want to edit the new file in <code class="highlighter-rouge">sites-available</code>, updating paths as well as names. You’ll also want to disable HTTPS redirection before setting up Let’s Encrypt (but remember to turn it back on).</p>

<p>You’ll also need to clone the repo into the home folder. You’ll need to set up SSH Forwarding for this and to clone the repo over SSH.</p>

<h3 id="running-1">Running</h3>

<p>Use <code class="highlighter-rouge">sudo service mongod start</code> to start MongoDb, and <code class="highlighter-rouge">pm2 start app.js -i 0 --name "app"</code> (assuming <code class="highlighter-rouge">app.js</code> is the main file and you’re in the directory you cloned) to start the main application for the first time. Later you can just use <code class="highlighter-rouge">pm2 start app</code>.</p>

<h3 id="backups">Backups</h3>

<table>
  <tbody>
    <tr>
      <td>Consider viewing [[this tutorial</td>
      <td>https://github.com/DJMcoder/HarkerDevGuides/wiki/Creating-Backup-Procedures]] for an in-depth guide on creating a backup procedure.</td>
    </tr>
  </tbody>
</table>


          
        </div>
      </div>
    </div>
  </div>
</html>
